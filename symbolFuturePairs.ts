import { HistoryObject } from './src/sm-lib/models';

export const symbolFuturePairs = [
  {
    futuresSymbol: 'SGZH',
    futuresShortName: 'SZZ4',
    stockSymbol: 'SGZH',
  },
  {
    futuresSymbol: 'SBRF',
    futuresShortName: 'SRZ4',
    stockSymbol: 'SBER',
  },
  {
    futuresSymbol: 'CNY',
    futuresShortName: 'CNY',
    stockSymbol: 'CNYRUB_TOM',
  },
  {
    futuresSymbol: 'MOEX',
    futuresShortName: 'MOEX',
    stockSymbol: 'IMOEX',
  },
  {
    futuresSymbol: 'GOLD',
    futuresShortName: 'GOLD',
    stockSymbol: 'GOLD',
  },
  {
    futuresSymbol: 'GAZR',
    futuresShortName: 'GZZ4',
    stockSymbol: 'GAZP',
  },
  {
    futuresSymbol: 'GMKN',
    futuresShortName: 'GKZ4',
    stockSymbol: 'GMKN',
  },
  {
    futuresSymbol: 'VTBR',
    futuresShortName: 'VBZ4',
    stockSymbol: 'VTBR',
  },
  {
    futuresSymbol: 'YDEX',
    futuresShortName: 'YDZ4',
    stockSymbol: 'YDEX',
  },
  {
    futuresSymbol: 'MGNT',
    futuresShortName: 'MNZ4',
    stockSymbol: 'MGNT',
  },
  {
    futuresSymbol: 'TRNF',
    futuresShortName: 'TNZ4',
    stockSymbol: 'TRNFP',
  },
  {
    futuresSymbol: 'VKCO',
    futuresShortName: 'VKZ4',
    stockSymbol: 'VKCO',
  },
  {
    futuresSymbol: 'RTKM',
    futuresShortName: 'RTZ4',
    stockSymbol: 'RTKM',
  },
  {
    futuresSymbol: 'RTKM',
    futuresShortName: 'RTZ4',
    stockSymbol: 'RTKMP',
  },
  {
    futuresSymbol: 'SMLT',
    futuresShortName: 'SSZ4',
    stockSymbol: 'SMLT',
  },
  {
    futuresSymbol: 'TCSI',
    futuresShortName: 'TIZ4',
    stockSymbol: 'TCSG',
  },
  {
    futuresSymbol: 'MTLR',
    futuresShortName: 'MCZ4',
    stockSymbol: 'MTLR',
  },
  {
    futuresSymbol: 'MTLR',
    futuresShortName: 'MCZ4',
    stockSymbol: 'MTLRP',
  },
  {
    futuresSymbol: 'LKOH',
    futuresShortName: 'LKZ4',
    stockSymbol: 'LKOH',
  },
  {
    futuresSymbol: 'ALRS',
    futuresShortName: 'ALZ4',
    stockSymbol: 'ALRS',
  },
  {
    futuresSymbol: 'POSI',
    futuresShortName: 'PSZ4',
    stockSymbol: 'POSI',
  },
  {
    futuresSymbol: 'RUAL',
    futuresShortName: 'RLZ4',
    stockSymbol: 'RUAL',
  },
  {
    futuresSymbol: 'RNFT',
    futuresShortName: 'RUZ4',
    stockSymbol: 'RNFT',
  },
  {
    futuresSymbol: 'MVID',
    futuresShortName: 'MVZ4',
    stockSymbol: 'MVID',
  },
  {
    futuresSymbol: 'ISKJ',
    futuresShortName: 'ISZ4',
    stockSymbol: 'ABIO',
  },
  {
    futuresSymbol: 'AFLT',
    futuresShortName: 'AFZ4',
    stockSymbol: 'AFLT',
  },
  {
    futuresSymbol: 'ROSN',
    futuresShortName: 'RNZ4',
    stockSymbol: 'ROSN',
  },
  {
    futuresSymbol: 'NLMK',
    futuresShortName: 'NMZ4',
    stockSymbol: 'NLMK',
  },
  {
    futuresSymbol: 'LEAS',
    futuresShortName: 'LEZ4',
    stockSymbol: 'LEAS',
  },
  {
    futuresSymbol: 'TATN',
    futuresShortName: 'TTZ4',
    stockSymbol: 'TATN',
  },
  {
    futuresSymbol: 'MOEX',
    futuresShortName: 'MEZ4',
    stockSymbol: 'MOEX',
  },
  {
    futuresSymbol: 'SIBN',
    futuresShortName: 'SOZ4',
    stockSymbol: 'SIBN',
  },
  {
    futuresSymbol: 'ASTR',
    futuresShortName: 'ASZ4',
    stockSymbol: 'ASTR',
  },
  {
    futuresSymbol: 'SOFL',
    futuresShortName: 'S0Z4',
    stockSymbol: 'SOFL',
  },
  {
    futuresSymbol: 'PIKK',
    futuresShortName: 'PIZ4',
    stockSymbol: 'PIKK',
  },
  {
    futuresSymbol: 'SNGR',
    futuresShortName: 'SNZ4',
    stockSymbol: 'SNGS',
  },
  {
    futuresSymbol: 'AFKS',
    futuresShortName: 'AKZ4',
    stockSymbol: 'AFKS',
  },
  {
    futuresSymbol: 'BANE',
    futuresShortName: 'BNZ4',
    stockSymbol: 'BANE',
  },
  {
    futuresSymbol: 'BANE',
    futuresShortName: 'BNZ4',
    stockSymbol: 'BANEP',
  },
  {
    futuresSymbol: 'WUSH',
    futuresShortName: 'WUZ4',
    stockSymbol: 'WUSH',
  },
  {
    futuresSymbol: 'FLOT',
    futuresShortName: 'FLZ4',
    stockSymbol: 'FLOT',
  },
  {
    futuresSymbol: 'SBPR',
    futuresShortName: 'SPZ4',
    stockSymbol: 'SBERP',
  },
  {
    futuresSymbol: 'BSPB',
    futuresShortName: 'BSZ4',
    stockSymbol: 'BSPB',
  },
  {
    futuresSymbol: 'PHOR',
    futuresShortName: 'PHZ4',
    stockSymbol: 'PHOR',
  },
  {
    futuresSymbol: 'RASP',
    futuresShortName: 'RAZ4',
    stockSymbol: 'RASP',
  },
  {
    futuresSymbol: 'SNGP',
    futuresShortName: 'SGZ4',
    stockSymbol: 'SNGSP',
  },
  {
    futuresSymbol: 'KMAZ',
    futuresShortName: 'KMZ4',
    stockSymbol: 'KMAZ',
  },
  {
    futuresSymbol: 'TATP',
    futuresShortName: 'TPZ4',
    stockSymbol: 'TATNP',
  },
  {
    futuresSymbol: 'FESH',
    futuresShortName: 'FEZ4',
    stockSymbol: 'FESH',
  },
  {
    futuresSymbol: 'HYDR',
    futuresShortName: 'HYZ4',
    stockSymbol: 'HYDR',
  },
  {
    futuresSymbol: 'MTSI',
    futuresShortName: 'MTZ4',
    stockSymbol: 'MTSS',
  },
  {
    futuresSymbol: 'FEES',
    futuresShortName: 'FSZ4',
    stockSymbol: 'FEES',
  },
  {
    futuresSymbol: 'NOTK',
    futuresShortName: 'NKZ4',
    stockSymbol: 'NVTK',
  },
  {
    futuresSymbol: 'MAGN',
    futuresShortName: 'MGZ4',
    stockSymbol: 'MAGN',
  },
  {
    futuresSymbol: 'SVCB',
    futuresShortName: 'SCZ4',
    stockSymbol: 'SVCB',
  },
  {
    futuresSymbol: 'CBOM',
    futuresShortName: 'CMZ4',
    stockSymbol: 'CBOM',
  },
  {
    futuresSymbol: 'PLZL',
    futuresShortName: 'PZZ4',
    stockSymbol: 'PLZL',
  },
  {
    futuresSymbol: 'SPBE',
    futuresShortName: 'SEZ4',
    stockSymbol: 'SPBE',
  },
  {
    futuresSymbol: 'SFIN',
    futuresShortName: 'SHZ4',
    stockSymbol: 'SFIN',
  },
  {
    futuresSymbol: 'CHMF',
    futuresShortName: 'CHZ4',
    stockSymbol: 'CHMF',
  },
  {
    futuresSymbol: 'IRAO',
    futuresShortName: 'IRZ4',
    stockSymbol: 'IRAO',
  },
];

export function calculateEMA(prices, period): [number, number[]] {
  const alpha = 2 / (period + 1);
  let ema = prices[0];
  const array = [prices[0]];

  for (let i = 1; i < prices.length; i++) {
    ema = prices[i] * alpha + ema * (1 - alpha);
    array.push(ema);
  }

  return [ema, array];
}

export function calculateBollingerBands(prices: number[], period: number = 20, multiplier: number = 2) {
  if (prices.length < period) return { upper: [], middle: [], lower: [] };

  const middleBand = calculateEMA(prices, period)[1]; // Твоя функция EMA
  const stdDev: number[] = [];

  // Рассчитываем стандартное отклонение
  for (let i = period - 1; i < prices.length; i++) {
    const slice = prices.slice(i - period + 1, i + 1);
    const mean = middleBand[i];
    const variance = slice.reduce((sum, price) => sum + Math.pow(price - mean, 2), 0) / period;
    stdDev.push(Math.sqrt(variance));
  }

  // Строим полосы (первые (period-1) значений будут undefined)
  const upperBand = middleBand.map((ema, i) => (i >= period - 1 ? ema + multiplier * stdDev[i - (period - 1)] : undefined));
  const lowerBand = middleBand.map((ema, i) => (i >= period - 1 ? ema - multiplier * stdDev[i - (period - 1)] : undefined));

  return { upper: upperBand, middle: middleBand, lower: lowerBand };
}

export const calculateCandle = (stockCandle: HistoryObject, futureCandle: HistoryObject, multiple: number = 100) => {
  if (!stockCandle) {
    return null;
  }
  if (!futureCandle) {
    return null;
  }

  return {
    open: futureCandle.open / stockCandle.open / multiple,
    close: futureCandle.close / stockCandle.close / multiple,
    high: futureCandle.high / stockCandle.high / multiple,
    low: futureCandle.low / stockCandle.low / multiple,
    time: stockCandle.time,
  } as HistoryObject;
};
